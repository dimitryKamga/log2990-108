"use strict";function cov_ej77p9x2a(){var path="C:\\Users\\USER\\Documents\\GitHub\\log2990-108\\server\\app\\services\\database.service.ts";var hash="d7dff810484c11d606d918ed0d3b880eb4f5d621";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\USER\\Documents\\GitHub\\log2990-108\\server\\app\\services\\database.service.ts",statementMap:{"0":{start:{line:2,column:17},end:{line:7,column:1}},"1":{start:{line:3,column:12},end:{line:3,column:28}},"2":{start:{line:3,column:34},end:{line:3,column:125}},"3":{start:{line:4,column:4},end:{line:5,column:150}},"4":{start:{line:4,column:79},end:{line:4,column:131}},"5":{start:{line:5,column:9},end:{line:5,column:150}},"6":{start:{line:5,column:22},end:{line:5,column:43}},"7":{start:{line:5,column:58},end:{line:5,column:150}},"8":{start:{line:5,column:81},end:{line:5,column:150}},"9":{start:{line:6,column:4},end:{line:6,column:66}},"10":{start:{line:8,column:16},end:{line:16,column:1}},"11":{start:{line:9,column:28},end:{line:9,column:110}},"12":{start:{line:9,column:91},end:{line:9,column:106}},"13":{start:{line:10,column:4},end:{line:15,column:7}},"14":{start:{line:11,column:36},end:{line:11,column:97}},"15":{start:{line:11,column:42},end:{line:11,column:70}},"16":{start:{line:11,column:85},end:{line:11,column:95}},"17":{start:{line:12,column:35},end:{line:12,column:100}},"18":{start:{line:12,column:41},end:{line:12,column:73}},"19":{start:{line:12,column:88},end:{line:12,column:98}},"20":{start:{line:13,column:32},end:{line:13,column:116}},"21":{start:{line:14,column:8},end:{line:14,column:78}},"22":{start:{line:17,column:0},end:{line:17,column:62}},"23":{start:{line:18,column:0},end:{line:18,column:33}},"24":{start:{line:19,column:20},end:{line:19,column:45}},"25":{start:{line:20,column:11},end:{line:20,column:24}},"26":{start:{line:21,column:20},end:{line:21,column:40}},"27":{start:{line:22,column:18},end:{line:22,column:36}},"28":{start:{line:23,column:15},end:{line:23,column:32}},"29":{start:{line:24,column:22},end:{line:113,column:1}},"30":{start:{line:26,column:8},end:{line:29,column:10}},"31":{start:{line:32,column:8},end:{line:32,column:153}},"32":{start:{line:33,column:8},end:{line:40,column:11}},"33":{start:{line:35,column:12},end:{line:35,column:33}},"34":{start:{line:36,column:12},end:{line:36,column:111}},"35":{start:{line:39,column:12},end:{line:39,column:62}},"36":{start:{line:43,column:8},end:{line:43,column:56}},"37":{start:{line:44,column:8},end:{line:44,column:33}},"38":{start:{line:47,column:8},end:{line:59,column:11}},"39":{start:{line:48,column:12},end:{line:58,column:13}},"40":{start:{line:49,column:16},end:{line:49,column:58}},"41":{start:{line:52,column:16},end:{line:57,column:17}},"42":{start:{line:53,column:20},end:{line:53,column:79}},"43":{start:{line:56,column:20},end:{line:56,column:63}},"44":{start:{line:62,column:8},end:{line:76,column:11}},"45":{start:{line:63,column:12},end:{line:75,column:15}},"46":{start:{line:67,column:39},end:{line:67,column:41}},"47":{start:{line:68,column:30},end:{line:68,column:69}},"48":{start:{line:69,column:16},end:{line:73,column:17}},"49":{start:{line:70,column:20},end:{line:72,column:21}},"50":{start:{line:71,column:24},end:{line:71,column:50}},"51":{start:{line:74,column:16},end:{line:74,column:38}},"52":{start:{line:79,column:8},end:{line:92,column:11}},"53":{start:{line:80,column:26},end:{line:80,column:65}},"54":{start:{line:81,column:12},end:{line:91,column:53}},"55":{start:{line:82,column:16},end:{line:82,column:82}},"56":{start:{line:83,column:16},end:{line:88,column:17}},"57":{start:{line:84,column:20},end:{line:84,column:73}},"58":{start:{line:87,column:20},end:{line:87,column:82}},"59":{start:{line:91,column:16},end:{line:91,column:53}},"60":{start:{line:95,column:8},end:{line:95,column:50}},"61":{start:{line:98,column:27},end:{line:98,column:31}},"62":{start:{line:99,column:21},end:{line:99,column:22}},"63":{start:{line:100,column:8},end:{line:105,column:11}},"64":{start:{line:101,column:12},end:{line:103,column:13}},"65":{start:{line:102,column:16},end:{line:102,column:37}},"66":{start:{line:104,column:12},end:{line:104,column:21}},"67":{start:{line:106,column:8},end:{line:106,column:62}},"68":{start:{line:109,column:35},end:{line:109,column:64}},"69":{start:{line:110,column:36},end:{line:110,column:65}},"70":{start:{line:111,column:8},end:{line:111,column:57}},"71":{start:{line:114,column:0},end:{line:116,column:20}},"72":{start:{line:117,column:0},end:{line:117,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:46},end:{line:2,column:47}},loc:{start:{line:2,column:87},end:{line:7,column:1}},line:2},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:44},end:{line:8,column:45}},loc:{start:{line:8,column:89},end:{line:16,column:1}},line:8},"2":{name:"adopt",decl:{start:{line:9,column:13},end:{line:9,column:18}},loc:{start:{line:9,column:26},end:{line:9,column:112}},line:9},"3":{name:"(anonymous_3)",decl:{start:{line:9,column:70},end:{line:9,column:71}},loc:{start:{line:9,column:89},end:{line:9,column:108}},line:9},"4":{name:"(anonymous_4)",decl:{start:{line:10,column:36},end:{line:10,column:37}},loc:{start:{line:10,column:63},end:{line:15,column:5}},line:10},"5":{name:"fulfilled",decl:{start:{line:11,column:17},end:{line:11,column:26}},loc:{start:{line:11,column:34},end:{line:11,column:99}},line:11},"6":{name:"rejected",decl:{start:{line:12,column:17},end:{line:12,column:25}},loc:{start:{line:12,column:33},end:{line:12,column:102}},line:12},"7":{name:"step",decl:{start:{line:13,column:17},end:{line:13,column:21}},loc:{start:{line:13,column:30},end:{line:13,column:118}},line:13},"8":{name:"(anonymous_8)",decl:{start:{line:25,column:4},end:{line:25,column:5}},loc:{start:{line:25,column:18},end:{line:30,column:5}},line:25},"9":{name:"(anonymous_9)",decl:{start:{line:31,column:4},end:{line:31,column:5}},loc:{start:{line:31,column:42},end:{line:41,column:5}},line:31},"10":{name:"(anonymous_10)",decl:{start:{line:34,column:18},end:{line:34,column:19}},loc:{start:{line:34,column:30},end:{line:37,column:9}},line:34},"11":{name:"(anonymous_11)",decl:{start:{line:38,column:19},end:{line:38,column:20}},loc:{start:{line:38,column:30},end:{line:40,column:9}},line:38},"12":{name:"(anonymous_12)",decl:{start:{line:42,column:4},end:{line:42,column:5}},loc:{start:{line:42,column:34},end:{line:45,column:5}},line:42},"13":{name:"(anonymous_13)",decl:{start:{line:46,column:4},end:{line:46,column:5}},loc:{start:{line:46,column:25},end:{line:60,column:5}},line:46},"14":{name:"(anonymous_14)",decl:{start:{line:47,column:47},end:{line:47,column:48}},loc:{start:{line:47,column:60},end:{line:59,column:9}},line:47},"15":{name:"(anonymous_15)",decl:{start:{line:61,column:4},end:{line:61,column:5}},loc:{start:{line:61,column:18},end:{line:77,column:5}},line:61},"16":{name:"(anonymous_16)",decl:{start:{line:62,column:47},end:{line:62,column:48}},loc:{start:{line:62,column:60},end:{line:76,column:9}},line:62},"17":{name:"(anonymous_17)",decl:{start:{line:66,column:22},end:{line:66,column:23}},loc:{start:{line:66,column:34},end:{line:75,column:13}},line:66},"18":{name:"(anonymous_18)",decl:{start:{line:78,column:4},end:{line:78,column:5}},loc:{start:{line:78,column:31},end:{line:93,column:5}},line:78},"19":{name:"(anonymous_19)",decl:{start:{line:79,column:47},end:{line:79,column:48}},loc:{start:{line:79,column:60},end:{line:92,column:9}},line:79},"20":{name:"(anonymous_20)",decl:{start:{line:94,column:4},end:{line:94,column:5}},loc:{start:{line:94,column:20},end:{line:96,column:5}},line:94},"21":{name:"(anonymous_21)",decl:{start:{line:97,column:4},end:{line:97,column:5}},loc:{start:{line:97,column:20},end:{line:107,column:5}},line:97},"22":{name:"(anonymous_22)",decl:{start:{line:100,column:21},end:{line:100,column:22}},loc:{start:{line:100,column:30},end:{line:105,column:9}},line:100},"23":{name:"(anonymous_23)",decl:{start:{line:108,column:4},end:{line:108,column:5}},loc:{start:{line:108,column:28},end:{line:112,column:5}},line:108}},branchMap:{"0":{loc:{start:{line:2,column:17},end:{line:7,column:1}},type:"binary-expr",locations:[{start:{line:2,column:18},end:{line:2,column:22}},{start:{line:2,column:26},end:{line:2,column:41}},{start:{line:2,column:46},end:{line:7,column:1}}],line:2},"1":{loc:{start:{line:3,column:34},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:42},end:{line:3,column:48}},{start:{line:3,column:51},end:{line:3,column:125}}],line:3},"2":{loc:{start:{line:3,column:51},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:67},end:{line:3,column:118}},{start:{line:3,column:121},end:{line:3,column:125}}],line:3},"3":{loc:{start:{line:4,column:4},end:{line:5,column:150}},type:"if",locations:[{start:{line:4,column:4},end:{line:5,column:150}},{start:{line:4,column:4},end:{line:5,column:150}}],line:4},"4":{loc:{start:{line:4,column:8},end:{line:4,column:77}},type:"binary-expr",locations:[{start:{line:4,column:8},end:{line:4,column:35}},{start:{line:4,column:39},end:{line:4,column:77}}],line:4},"5":{loc:{start:{line:5,column:58},end:{line:5,column:150}},type:"if",locations:[{start:{line:5,column:58},end:{line:5,column:150}},{start:{line:5,column:58},end:{line:5,column:150}}],line:5},"6":{loc:{start:{line:5,column:85},end:{line:5,column:149}},type:"binary-expr",locations:[{start:{line:5,column:86},end:{line:5,column:143}},{start:{line:5,column:148},end:{line:5,column:149}}],line:5},"7":{loc:{start:{line:5,column:86},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:94},end:{line:5,column:98}},{start:{line:5,column:101},end:{line:5,column:143}}],line:5},"8":{loc:{start:{line:5,column:101},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:109},end:{line:5,column:126}},{start:{line:5,column:129},end:{line:5,column:143}}],line:5},"9":{loc:{start:{line:6,column:11},end:{line:6,column:62}},type:"binary-expr",locations:[{start:{line:6,column:11},end:{line:6,column:16}},{start:{line:6,column:20},end:{line:6,column:21}},{start:{line:6,column:25},end:{line:6,column:62}}],line:6},"10":{loc:{start:{line:8,column:16},end:{line:16,column:1}},type:"binary-expr",locations:[{start:{line:8,column:17},end:{line:8,column:21}},{start:{line:8,column:25},end:{line:8,column:39}},{start:{line:8,column:44},end:{line:16,column:1}}],line:8},"11":{loc:{start:{line:9,column:35},end:{line:9,column:109}},type:"cond-expr",locations:[{start:{line:9,column:56},end:{line:9,column:61}},{start:{line:9,column:64},end:{line:9,column:109}}],line:9},"12":{loc:{start:{line:10,column:16},end:{line:10,column:34}},type:"binary-expr",locations:[{start:{line:10,column:16},end:{line:10,column:17}},{start:{line:10,column:22},end:{line:10,column:33}}],line:10},"13":{loc:{start:{line:13,column:32},end:{line:13,column:115}},type:"cond-expr",locations:[{start:{line:13,column:46},end:{line:13,column:67}},{start:{line:13,column:70},end:{line:13,column:115}}],line:13},"14":{loc:{start:{line:14,column:51},end:{line:14,column:67}},type:"binary-expr",locations:[{start:{line:14,column:51},end:{line:14,column:61}},{start:{line:14,column:65},end:{line:14,column:67}}],line:14},"15":{loc:{start:{line:31,column:10},end:{line:31,column:40}},type:"default-arg",locations:[{start:{line:31,column:16},end:{line:31,column:40}}],line:31},"16":{loc:{start:{line:32,column:8},end:{line:32,column:152}},type:"cond-expr",locations:[{start:{line:32,column:50},end:{line:32,column:87}},{start:{line:32,column:91},end:{line:32,column:151}}],line:32},"17":{loc:{start:{line:48,column:12},end:{line:58,column:13}},type:"if",locations:[{start:{line:48,column:12},end:{line:58,column:13}},{start:{line:48,column:12},end:{line:58,column:13}}],line:48},"18":{loc:{start:{line:70,column:20},end:{line:72,column:21}},type:"if",locations:[{start:{line:70,column:20},end:{line:72,column:21}},{start:{line:70,column:20},end:{line:72,column:21}}],line:70},"19":{loc:{start:{line:81,column:12},end:{line:91,column:53}},type:"if",locations:[{start:{line:81,column:12},end:{line:91,column:53}},{start:{line:81,column:12},end:{line:91,column:53}}],line:81},"20":{loc:{start:{line:101,column:12},end:{line:103,column:13}},type:"if",locations:[{start:{line:101,column:12},end:{line:103,column:13}},{start:{line:101,column:12},end:{line:103,column:13}}],line:101},"21":{loc:{start:{line:106,column:15},end:{line:106,column:61}},type:"binary-expr",locations:[{start:{line:106,column:15},end:{line:106,column:27}},{start:{line:106,column:31},end:{line:106,column:61}}],line:106},"22":{loc:{start:{line:111,column:15},end:{line:111,column:56}},type:"binary-expr",locations:[{start:{line:111,column:15},end:{line:111,column:33}},{start:{line:111,column:37},end:{line:111,column:56}}],line:111}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},inputSourceMap:{version:3,file:"C:/Users/USER/Documents/GitHub/log2990-108/server/app/services/database.service.ts",sources:["C:/Users/USER/Documents/GitHub/log2990-108/server/app/services/database.service.ts"],names:[],mappings:"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",sourcesContent:["import { DATABASE_COLLECTION, DATABASE_NAME, DATABASE_URL, MAX_TAGS, REGEX_TAG, REGEX_TITLE, STORAGE_DIR } from '@app/constants';\nimport { MetaData } from '@common/communication/metadata';\nimport * as fs from 'fs';\nimport { injectable } from 'inversify';\nimport { Collection, MongoClient, MongoClientOptions } from 'mongodb';\nimport * as multer from 'multer';\n\n@injectable()\nexport class DatabaseService {\n    client: MongoClient;\n    collection: Collection<MetaData>;\n    multerObject: multer.Multer;\n    localDrawings: string[];\n\n    private options: MongoClientOptions = {\n        useNewUrlParser: true,\n        useUnifiedTopology: true,\n    };\n\n    start(url = DATABASE_URL) {\n        !fs.existsSync(STORAGE_DIR) ? fs.mkdirSync(STORAGE_DIR) : (this.localDrawings = fs.readdirSync(STORAGE_DIR));\n        MongoClient.connect(url, this.options)\n            .then((client: MongoClient) => {\n                this.client = client;\n                this.collection = client.db(DATABASE_NAME).collection(DATABASE_COLLECTION);\n            })\n            .catch((error : Error) => {\n                throw error.message = \"Database connection error\";\n            });\n    }\n\n    createMulterUpload(directory: string): multer.Multer {\n        this.multerObject = multer({ dest: directory });\n        return this.multerObject;\n    }\n\n    async addDrawing(metaData: MetaData): Promise<void> {\n        if (this.checkMetaData(metaData)) {\n            await this.collection.insertOne(metaData);\n        } else {\n            try {\n                fs.unlinkSync(STORAGE_DIR + metaData.filename);\n            } catch (error) {\n                throw new Error('M\xE9tadonn\xE9es non valides');\n            }\n        }\n    }\n\n    async getMetaData(): Promise<MetaData[]> {\n        return this.collection\n        .find()\n        .toArray()\n        .then((dBData: MetaData[]) => {\n            const dBDataverified: MetaData[] = [];\n            const files: string[] = fs.readdirSync(STORAGE_DIR);\n            for (const data of dBData) {\n                if (files.includes(data.filename)) {\n                    dBDataverified.push(data);\n                }\n            }\n            return dBDataverified;\n        });\n    }\n\n    async deleteDrawing(newFilename: string): Promise<void> {\n        const files: string[] = fs.readdirSync(STORAGE_DIR);\n        if (files.includes(newFilename)) {\n            await this.collection.findOneAndDelete({ filename: newFilename });\n            try {\n                fs.unlinkSync(STORAGE_DIR + newFilename);\n            } catch (error) {\n                throw new Error(\"Probl\xE8me lors de la suppression de l'image\");\n            }\n        } else throw new Error('Image introuvable');\n    }\n\n    checkName(name: string): boolean {\n        return REGEX_TITLE.test(name);\n    }\n\n    checkTags(tags: string[]): boolean {\n        let validTagList = true;\n        let tagCtr = 0;\n        tags.forEach((tag) => {\n            if (!REGEX_TAG.test(tag)) {\n                validTagList = false;\n            }\n            tagCtr++;\n        });\n        return validTagList && tagCtr <= MAX_TAGS;\n    }\n\n    checkMetaData(metaData: MetaData): boolean {\n        const containsValidTitle = this.checkName(metaData.name);\n        const containsCorrectTags = this.checkTags(metaData.tags);\n        return containsValidTitle && containsCorrectTags;\n    }\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d7dff810484c11d606d918ed0d3b880eb4f5d621"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_ej77p9x2a=function(){return actualCoverage;};}return actualCoverage;}cov_ej77p9x2a();var __decorate=(cov_ej77p9x2a().s[0]++,(cov_ej77p9x2a().b[0][0]++,this)&&(cov_ej77p9x2a().b[0][1]++,this.__decorate)||(cov_ej77p9x2a().b[0][2]++,function(decorators,target,key,desc){cov_ej77p9x2a().f[0]++;var c=(cov_ej77p9x2a().s[1]++,arguments.length),r=(cov_ej77p9x2a().s[2]++,c<3?(cov_ej77p9x2a().b[1][0]++,target):(cov_ej77p9x2a().b[1][1]++,desc===null?(cov_ej77p9x2a().b[2][0]++,desc=Object.getOwnPropertyDescriptor(target,key)):(cov_ej77p9x2a().b[2][1]++,desc))),d;cov_ej77p9x2a().s[3]++;if((cov_ej77p9x2a().b[4][0]++,typeof Reflect==="object")&&(cov_ej77p9x2a().b[4][1]++,typeof Reflect.decorate==="function")){cov_ej77p9x2a().b[3][0]++;cov_ej77p9x2a().s[4]++;r=Reflect.decorate(decorators,target,key,desc);}else{cov_ej77p9x2a().b[3][1]++;cov_ej77p9x2a().s[5]++;for(var i=(cov_ej77p9x2a().s[6]++,decorators.length-1);i>=0;i--){cov_ej77p9x2a().s[7]++;if(d=decorators[i]){cov_ej77p9x2a().b[5][0]++;cov_ej77p9x2a().s[8]++;r=(cov_ej77p9x2a().b[6][0]++,c<3?(cov_ej77p9x2a().b[7][0]++,d(r)):(cov_ej77p9x2a().b[7][1]++,c>3?(cov_ej77p9x2a().b[8][0]++,d(target,key,r)):(cov_ej77p9x2a().b[8][1]++,d(target,key))))||(cov_ej77p9x2a().b[6][1]++,r);}else{cov_ej77p9x2a().b[5][1]++;}}}cov_ej77p9x2a().s[9]++;return(cov_ej77p9x2a().b[9][0]++,c>3)&&(cov_ej77p9x2a().b[9][1]++,r)&&(cov_ej77p9x2a().b[9][2]++,Object.defineProperty(target,key,r)),r;}));var __awaiter=(cov_ej77p9x2a().s[10]++,(cov_ej77p9x2a().b[10][0]++,this)&&(cov_ej77p9x2a().b[10][1]++,this.__awaiter)||(cov_ej77p9x2a().b[10][2]++,function(thisArg,_arguments,P,generator){cov_ej77p9x2a().f[1]++;function adopt(value){cov_ej77p9x2a().f[2]++;cov_ej77p9x2a().s[11]++;return value instanceof P?(cov_ej77p9x2a().b[11][0]++,value):(cov_ej77p9x2a().b[11][1]++,new P(function(resolve){cov_ej77p9x2a().f[3]++;cov_ej77p9x2a().s[12]++;resolve(value);}));}cov_ej77p9x2a().s[13]++;return new((cov_ej77p9x2a().b[12][0]++,P)||(cov_ej77p9x2a().b[12][1]++,P=Promise))(function(resolve,reject){cov_ej77p9x2a().f[4]++;function fulfilled(value){cov_ej77p9x2a().f[5]++;cov_ej77p9x2a().s[14]++;try{cov_ej77p9x2a().s[15]++;step(generator.next(value));}catch(e){cov_ej77p9x2a().s[16]++;reject(e);}}function rejected(value){cov_ej77p9x2a().f[6]++;cov_ej77p9x2a().s[17]++;try{cov_ej77p9x2a().s[18]++;step(generator["throw"](value));}catch(e){cov_ej77p9x2a().s[19]++;reject(e);}}function step(result){cov_ej77p9x2a().f[7]++;cov_ej77p9x2a().s[20]++;result.done?(cov_ej77p9x2a().b[13][0]++,resolve(result.value)):(cov_ej77p9x2a().b[13][1]++,adopt(result.value).then(fulfilled,rejected));}cov_ej77p9x2a().s[21]++;step((generator=generator.apply(thisArg,(cov_ej77p9x2a().b[14][0]++,_arguments)||(cov_ej77p9x2a().b[14][1]++,[]))).next());});}));cov_ej77p9x2a().s[22]++;Object.defineProperty(exports,"__esModule",{value:true});cov_ej77p9x2a().s[23]++;exports.DatabaseService=void 0;const constants_1=(cov_ej77p9x2a().s[24]++,require("@app/constants"));const fs=(cov_ej77p9x2a().s[25]++,require("fs"));const inversify_1=(cov_ej77p9x2a().s[26]++,require("inversify"));const mongodb_1=(cov_ej77p9x2a().s[27]++,require("mongodb"));const multer=(cov_ej77p9x2a().s[28]++,require("multer"));cov_ej77p9x2a().s[29]++;let DatabaseService=class DatabaseService{constructor(){cov_ej77p9x2a().f[8]++;cov_ej77p9x2a().s[30]++;this.options={useNewUrlParser:true,useUnifiedTopology:true};}start(url=(cov_ej77p9x2a().b[15][0]++,constants_1.DATABASE_URL)){cov_ej77p9x2a().f[9]++;cov_ej77p9x2a().s[31]++;!fs.existsSync(constants_1.STORAGE_DIR)?(cov_ej77p9x2a().b[16][0]++,fs.mkdirSync(constants_1.STORAGE_DIR)):(cov_ej77p9x2a().b[16][1]++,this.localDrawings=fs.readdirSync(constants_1.STORAGE_DIR));cov_ej77p9x2a().s[32]++;mongodb_1.MongoClient.connect(url,this.options).then(client=>{cov_ej77p9x2a().f[10]++;cov_ej77p9x2a().s[33]++;this.client=client;cov_ej77p9x2a().s[34]++;this.collection=client.db(constants_1.DATABASE_NAME).collection(constants_1.DATABASE_COLLECTION);}).catch(error=>{cov_ej77p9x2a().f[11]++;cov_ej77p9x2a().s[35]++;throw error.message="Database connection error";});}createMulterUpload(directory){cov_ej77p9x2a().f[12]++;cov_ej77p9x2a().s[36]++;this.multerObject=multer({dest:directory});cov_ej77p9x2a().s[37]++;return this.multerObject;}addDrawing(metaData){cov_ej77p9x2a().f[13]++;cov_ej77p9x2a().s[38]++;return __awaiter(this,void 0,void 0,function*(){cov_ej77p9x2a().f[14]++;cov_ej77p9x2a().s[39]++;if(this.checkMetaData(metaData)){cov_ej77p9x2a().b[17][0]++;cov_ej77p9x2a().s[40]++;yield this.collection.insertOne(metaData);}else{cov_ej77p9x2a().b[17][1]++;cov_ej77p9x2a().s[41]++;try{cov_ej77p9x2a().s[42]++;fs.unlinkSync(constants_1.STORAGE_DIR+metaData.filename);}catch(error){cov_ej77p9x2a().s[43]++;throw new Error('Métadonnées non valides');}}});}getMetaData(){cov_ej77p9x2a().f[15]++;cov_ej77p9x2a().s[44]++;return __awaiter(this,void 0,void 0,function*(){cov_ej77p9x2a().f[16]++;cov_ej77p9x2a().s[45]++;return this.collection.find().toArray().then(dBData=>{cov_ej77p9x2a().f[17]++;const dBDataverified=(cov_ej77p9x2a().s[46]++,[]);const files=(cov_ej77p9x2a().s[47]++,fs.readdirSync(constants_1.STORAGE_DIR));cov_ej77p9x2a().s[48]++;for(const data of dBData){cov_ej77p9x2a().s[49]++;if(files.includes(data.filename)){cov_ej77p9x2a().b[18][0]++;cov_ej77p9x2a().s[50]++;dBDataverified.push(data);}else{cov_ej77p9x2a().b[18][1]++;}}cov_ej77p9x2a().s[51]++;return dBDataverified;});});}deleteDrawing(newFilename){cov_ej77p9x2a().f[18]++;cov_ej77p9x2a().s[52]++;return __awaiter(this,void 0,void 0,function*(){cov_ej77p9x2a().f[19]++;const files=(cov_ej77p9x2a().s[53]++,fs.readdirSync(constants_1.STORAGE_DIR));cov_ej77p9x2a().s[54]++;if(files.includes(newFilename)){cov_ej77p9x2a().b[19][0]++;cov_ej77p9x2a().s[55]++;yield this.collection.findOneAndDelete({filename:newFilename});cov_ej77p9x2a().s[56]++;try{cov_ej77p9x2a().s[57]++;fs.unlinkSync(constants_1.STORAGE_DIR+newFilename);}catch(error){cov_ej77p9x2a().s[58]++;throw new Error("Problème lors de la suppression de l'image");}}else{cov_ej77p9x2a().b[19][1]++;cov_ej77p9x2a().s[59]++;throw new Error('Image introuvable');}});}checkName(name){cov_ej77p9x2a().f[20]++;cov_ej77p9x2a().s[60]++;return constants_1.REGEX_TITLE.test(name);}checkTags(tags){cov_ej77p9x2a().f[21]++;let validTagList=(cov_ej77p9x2a().s[61]++,true);let tagCtr=(cov_ej77p9x2a().s[62]++,0);cov_ej77p9x2a().s[63]++;tags.forEach(tag=>{cov_ej77p9x2a().f[22]++;cov_ej77p9x2a().s[64]++;if(!constants_1.REGEX_TAG.test(tag)){cov_ej77p9x2a().b[20][0]++;cov_ej77p9x2a().s[65]++;validTagList=false;}else{cov_ej77p9x2a().b[20][1]++;}cov_ej77p9x2a().s[66]++;tagCtr++;});cov_ej77p9x2a().s[67]++;return(cov_ej77p9x2a().b[21][0]++,validTagList)&&(cov_ej77p9x2a().b[21][1]++,tagCtr<=constants_1.MAX_TAGS);}checkMetaData(metaData){cov_ej77p9x2a().f[23]++;const containsValidTitle=(cov_ej77p9x2a().s[68]++,this.checkName(metaData.name));const containsCorrectTags=(cov_ej77p9x2a().s[69]++,this.checkTags(metaData.tags));cov_ej77p9x2a().s[70]++;return(cov_ej77p9x2a().b[22][0]++,containsValidTitle)&&(cov_ej77p9x2a().b[22][1]++,containsCorrectTags);}};cov_ej77p9x2a().s[71]++;DatabaseService=__decorate([inversify_1.injectable()],DatabaseService);cov_ej77p9x2a().s[72]++;exports.DatabaseService=DatabaseService;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvVVNFUi9Eb2N1bWVudHMvR2l0SHViL2xvZzI5OTAtMTA4L3NlcnZlci9hcHAvc2VydmljZXMvZGF0YWJhc2Uuc2VydmljZS50cyIsInNvdXJjZXMiOlsiQzovVXNlcnMvVVNFUi9Eb2N1bWVudHMvR2l0SHViL2xvZzI5OTAtMTA4L3NlcnZlci9hcHAvc2VydmljZXMvZGF0YWJhc2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBaUk7QUFFakkseUJBQXlCO0FBQ3pCLHlDQUF1QztBQUN2QyxxQ0FBc0U7QUFDdEUsaUNBQWlDO0FBR2pDLElBQWEsZUFBZSxHQUE1QixNQUFhLGVBQWU7SUFBNUI7UUFNWSxZQUFPLEdBQXVCO1lBQ2xDLGVBQWUsRUFBRSxJQUFJO1lBQ3JCLGtCQUFrQixFQUFFLElBQUk7U0FDM0IsQ0FBQztJQWdGTixDQUFDO0lBOUVHLEtBQUssQ0FBQyxHQUFHLEdBQUcsd0JBQVk7UUFDcEIsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLHVCQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyx1QkFBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLHVCQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzdHLHFCQUFXLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDO2FBQ2pDLElBQUksQ0FBQyxDQUFDLE1BQW1CLEVBQUUsRUFBRTtZQUMxQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUNyQixJQUFJLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMseUJBQWEsQ0FBQyxDQUFDLFVBQVUsQ0FBQywrQkFBbUIsQ0FBQyxDQUFDO1FBQy9FLENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxDQUFDLEtBQWEsRUFBRSxFQUFFO1lB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UUFDekQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxRCxPQUFPLGtCQUFrQixJQUFJLG1CQUFtQixDQUFDO0lBQ3JELENBQUM7Q0FDSixDQUFBO0FBekZZLGVBQWU7SUFEM0Isc0JBQVUsRUFBRTtHQUNBLGVBQWUsQ0F5RjNCO0FBekZZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREFUQUJBU0VfQ09MTEVDVElPTiwgREFUQUJBU0VfTkFNRSwgREFUQUJBU0VfVVJMLCBNQVhfVEFHUywgUkVHRVhfVEFHLCBSRUdFWF9USVRMRSwgU1RPUkFHRV9ESVIgfSBmcm9tICdAYXBwL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBNZXRhRGF0YSB9IGZyb20gJ0Bjb21tb24vY29tbXVuaWNhdGlvbi9tZXRhZGF0YSc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgeyBpbmplY3RhYmxlIH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IENvbGxlY3Rpb24sIE1vbmdvQ2xpZW50LCBNb25nb0NsaWVudE9wdGlvbnMgfSBmcm9tICdtb25nb2RiJztcbmltcG9ydCAqIGFzIG11bHRlciBmcm9tICdtdWx0ZXInO1xuXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGF0YWJhc2VTZXJ2aWNlIHtcbiAgICBjbGllbnQ6IE1vbmdvQ2xpZW50O1xuICAgIGNvbGxlY3Rpb246IENvbGxlY3Rpb248TWV0YURhdGE+O1xuICAgIG11bHRlck9iamVjdDogbXVsdGVyLk11bHRlcjtcbiAgICBsb2NhbERyYXdpbmdzOiBzdHJpbmdbXTtcblxuICAgIHByaXZhdGUgb3B0aW9uczogTW9uZ29DbGllbnRPcHRpb25zID0ge1xuICAgICAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXG4gICAgICAgIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgc3RhcnQodXJsID0gREFUQUJBU0VfVVJMKSB7XG4gICAgICAgICFmcy5leGlzdHNTeW5jKFNUT1JBR0VfRElSKSA/IGZzLm1rZGlyU3luYyhTVE9SQUdFX0RJUikgOiAodGhpcy5sb2NhbERyYXdpbmdzID0gZnMucmVhZGRpclN5bmMoU1RPUkFHRV9ESVIpKTtcbiAgICAgICAgTW9uZ29DbGllbnQuY29ubmVjdCh1cmwsIHRoaXMub3B0aW9ucylcbiAgICAgICAgICAgIC50aGVuKChjbGllbnQ6IE1vbmdvQ2xpZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gY2xpZW50LmRiKERBVEFCQVNFX05BTUUpLmNvbGxlY3Rpb24oREFUQUJBU0VfQ09MTEVDVElPTik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvciA6IEVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3IubWVzc2FnZSA9IFwiRGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvclwiO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY3JlYXRlTXVsdGVyVXBsb2FkKGRpcmVjdG9yeTogc3RyaW5nKTogbXVsdGVyLk11bHRlciB7XG4gICAgICAgIHRoaXMubXVsdGVyT2JqZWN0ID0gbXVsdGVyKHsgZGVzdDogZGlyZWN0b3J5IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5tdWx0ZXJPYmplY3Q7XG4gICAgfVxuXG4gICAgYXN5bmMgYWRkRHJhd2luZyhtZXRhRGF0YTogTWV0YURhdGEpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tNZXRhRGF0YShtZXRhRGF0YSkpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY29sbGVjdGlvbi5pbnNlcnRPbmUobWV0YURhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKFNUT1JBR0VfRElSICsgbWV0YURhdGEuZmlsZW5hbWUpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ03DqXRhZG9ubsOpZXMgbm9uIHZhbGlkZXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldE1ldGFEYXRhKCk6IFByb21pc2U8TWV0YURhdGFbXT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uXG4gICAgICAgIC5maW5kKClcbiAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAudGhlbigoZEJEYXRhOiBNZXRhRGF0YVtdKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkQkRhdGF2ZXJpZmllZDogTWV0YURhdGFbXSA9IFtdO1xuICAgICAgICAgICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gZnMucmVhZGRpclN5bmMoU1RPUkFHRV9ESVIpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBkYXRhIG9mIGRCRGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChmaWxlcy5pbmNsdWRlcyhkYXRhLmZpbGVuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBkQkRhdGF2ZXJpZmllZC5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkQkRhdGF2ZXJpZmllZDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZGVsZXRlRHJhd2luZyhuZXdGaWxlbmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGZpbGVzOiBzdHJpbmdbXSA9IGZzLnJlYWRkaXJTeW5jKFNUT1JBR0VfRElSKTtcbiAgICAgICAgaWYgKGZpbGVzLmluY2x1ZGVzKG5ld0ZpbGVuYW1lKSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmZpbmRPbmVBbmREZWxldGUoeyBmaWxlbmFtZTogbmV3RmlsZW5hbWUgfSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGZzLnVubGlua1N5bmMoU1RPUkFHRV9ESVIgKyBuZXdGaWxlbmFtZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlByb2Jsw6htZSBsb3JzIGRlIGxhIHN1cHByZXNzaW9uIGRlIGwnaW1hZ2VcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB0aHJvdyBuZXcgRXJyb3IoJ0ltYWdlIGludHJvdXZhYmxlJyk7XG4gICAgfVxuXG4gICAgY2hlY2tOYW1lKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gUkVHRVhfVElUTEUudGVzdChuYW1lKTtcbiAgICB9XG5cbiAgICBjaGVja1RhZ3ModGFnczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgbGV0IHZhbGlkVGFnTGlzdCA9IHRydWU7XG4gICAgICAgIGxldCB0YWdDdHIgPSAwO1xuICAgICAgICB0YWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKCFSRUdFWF9UQUcudGVzdCh0YWcpKSB7XG4gICAgICAgICAgICAgICAgdmFsaWRUYWdMaXN0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YWdDdHIrKztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB2YWxpZFRhZ0xpc3QgJiYgdGFnQ3RyIDw9IE1BWF9UQUdTO1xuICAgIH1cblxuICAgIGNoZWNrTWV0YURhdGEobWV0YURhdGE6IE1ldGFEYXRhKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5zVmFsaWRUaXRsZSA9IHRoaXMuY2hlY2tOYW1lKG1ldGFEYXRhLm5hbWUpO1xuICAgICAgICBjb25zdCBjb250YWluc0NvcnJlY3RUYWdzID0gdGhpcy5jaGVja1RhZ3MobWV0YURhdGEudGFncyk7XG4gICAgICAgIHJldHVybiBjb250YWluc1ZhbGlkVGl0bGUgJiYgY29udGFpbnNDb3JyZWN0VGFncztcbiAgICB9XG59XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6L1VzZXJzL1VTRVIvRG9jdW1lbnRzL0dpdEh1Yi9sb2cyOTkwLTEwOC9zZXJ2ZXIvYXBwL3NlcnZpY2VzL2RhdGFiYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs4MEZBQUEsS0FBQSxDQUFBLFdBQUEsMEJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQSxDQUVBLEtBQUEsQ0FBQSxFQUFBLDBCQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxXQUFBLDBCQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxTQUFBLDBCQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxNQUFBLDBCQUFBLE9BQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDLHdCQUdBLEdBQWEsQ0FBQSxlQUFlLENBQTVCLEtBQWEsQ0FBQSxlQUFlLENBQTVCLFdBQUEsRUFBQSxnREFNWSxLQUFBLE9BQUEsQ0FBOEIsQ0FDbEMsZUFBZSxDQUFFLElBRGlCLENBRWxDLGtCQUFrQixDQUFFLElBRmMsQ0FBOUIsQ0FtRlgsQ0E5RUcsS0FBSyxDQUFDLEdBQUcsNkJBQUcsV0FBQSxDQUFBLFlBQUgsQ0FBSixDQUFtQixnREFDcEIsQ0FBQyxFQUFFLENBQUMsVUFBSCxDQUFjLFdBQUEsQ0FBQSxXQUFkLENBQUQsNkJBQThCLEVBQUUsQ0FBQyxTQUFILENBQWEsV0FBQSxDQUFBLFdBQWIsQ0FBOUIsOEJBQTJELEtBQUssYUFBTCxDQUFxQixFQUFFLENBQUMsV0FBSCxDQUFlLFdBQUEsQ0FBQSxXQUFmLENBQWhGLEVBRG9CLHdCQUVwQixTQUFBLENBQUEsV0FBQSxDQUFZLE9BQVosQ0FBb0IsR0FBcEIsQ0FBeUIsS0FBSyxPQUE5QixFQUNLLElBREwsQ0FDVyxNQUFELEVBQXdCLGlEQUMxQixLQUFLLE1BQUwsQ0FBYyxNQUFkLENBRDBCLHdCQUUxQixLQUFLLFVBQUwsQ0FBa0IsTUFB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TEQsRUFIb0Isd0JBU3BCLE1BQU8sNEJBQUEsWUFBWSwrQkFBSSxNQUFNLEVBQUksV0FBQSxDQUFBLFFBQWQsQ0FBbkIsQ0FDSCxDQUVELGFBQWEsQ0FBQyxRQUFELENBQW1CLHlCQUM1QixLQUFNLENBQUEsa0JBQWtCLDBCQUFHLEtBQUssU0FBTCxDQUFlLFFBQVEsQ0FBQyxJQUF4QixDQUFILENBQXhCLENBQ0EsS0FBTSxDQUFBLG1CQUFtQiwwQkFBRyxLQUFLLFNBQUwsQ0FBZSxRQUFRLENBQUMsSUFBeEIsQ0FBSCxDQUF6QixDQUY0Qix3QkFHNUIsTUFBTyw0QkFBQSxrQkFBa0IsK0JBQUksbUJBQUosQ0FBekIsQ0FDSCxDQXhGdUIsQ0FBNUIsQyx3QkFBYSxlQUFlLENBQUEsVUFBQSxDQUFBLENBRDNCLFdBQUEsQ0FBQSxVQUFBLEVBQzJCLENBQUEsQ0FBZixlQUFlLENBQWYsQyx3QkFBQSxPQUFBLENBQUEsZUFBQSxDQUFBLGVBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERBVEFCQVNFX0NPTExFQ1RJT04sIERBVEFCQVNFX05BTUUsIERBVEFCQVNFX1VSTCwgTUFYX1RBR1MsIFJFR0VYX1RBRywgUkVHRVhfVElUTEUsIFNUT1JBR0VfRElSIH0gZnJvbSAnQGFwcC9jb25zdGFudHMnO1xuaW1wb3J0IHsgTWV0YURhdGEgfSBmcm9tICdAY29tbW9uL2NvbW11bmljYXRpb24vbWV0YWRhdGEnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSB9IGZyb20gJ2ludmVyc2lmeSc7XG5pbXBvcnQgeyBDb2xsZWN0aW9uLCBNb25nb0NsaWVudCwgTW9uZ29DbGllbnRPcHRpb25zIH0gZnJvbSAnbW9uZ29kYic7XG5pbXBvcnQgKiBhcyBtdWx0ZXIgZnJvbSAnbXVsdGVyJztcblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERhdGFiYXNlU2VydmljZSB7XG4gICAgY2xpZW50OiBNb25nb0NsaWVudDtcbiAgICBjb2xsZWN0aW9uOiBDb2xsZWN0aW9uPE1ldGFEYXRhPjtcbiAgICBtdWx0ZXJPYmplY3Q6IG11bHRlci5NdWx0ZXI7XG4gICAgbG9jYWxEcmF3aW5nczogc3RyaW5nW107XG5cbiAgICBwcml2YXRlIG9wdGlvbnM6IE1vbmdvQ2xpZW50T3B0aW9ucyA9IHtcbiAgICAgICAgdXNlTmV3VXJsUGFyc2VyOiB0cnVlLFxuICAgICAgICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHRydWUsXG4gICAgfTtcblxuICAgIHN0YXJ0KHVybCA9IERBVEFCQVNFX1VSTCkge1xuICAgICAgICAhZnMuZXhpc3RzU3luYyhTVE9SQUdFX0RJUikgPyBmcy5ta2RpclN5bmMoU1RPUkFHRV9ESVIpIDogKHRoaXMubG9jYWxEcmF3aW5ncyA9IGZzLnJlYWRkaXJTeW5jKFNUT1JBR0VfRElSKSk7XG4gICAgICAgIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCB0aGlzLm9wdGlvbnMpXG4gICAgICAgICAgICAudGhlbigoY2xpZW50OiBNb25nb0NsaWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50O1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNsaWVudC5kYihEQVRBQkFTRV9OQU1FKS5jb2xsZWN0aW9uKERBVEFCQVNFX0NPTExFQ1RJT04pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IgOiBFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IGVycm9yLm1lc3NhZ2UgPSBcIkRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3JcIjtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNyZWF0ZU11bHRlclVwbG9hZChkaXJlY3Rvcnk6IHN0cmluZyk6IG11bHRlci5NdWx0ZXIge1xuICAgICAgICB0aGlzLm11bHRlck9iamVjdCA9IG11bHRlcih7IGRlc3Q6IGRpcmVjdG9yeSB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMubXVsdGVyT2JqZWN0O1xuICAgIH1cblxuICAgIGFzeW5jIGFkZERyYXdpbmcobWV0YURhdGE6IE1ldGFEYXRhKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrTWV0YURhdGEobWV0YURhdGEpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNvbGxlY3Rpb24uaW5zZXJ0T25lKG1ldGFEYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhTVE9SQUdFX0RJUiArIG1ldGFEYXRhLmZpbGVuYW1lKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNw6l0YWRvbm7DqWVzIG5vbiB2YWxpZGVzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZXRNZXRhRGF0YSgpOiBQcm9taXNlPE1ldGFEYXRhW10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sbGVjdGlvblxuICAgICAgICAuZmluZCgpXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgICAgLnRoZW4oKGRCRGF0YTogTWV0YURhdGFbXSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZEJEYXRhdmVyaWZpZWQ6IE1ldGFEYXRhW10gPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzOiBzdHJpbmdbXSA9IGZzLnJlYWRkaXJTeW5jKFNUT1JBR0VfRElSKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZGF0YSBvZiBkQkRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZXMuaW5jbHVkZXMoZGF0YS5maWxlbmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZEJEYXRhdmVyaWZpZWQucHVzaChkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZEJEYXRhdmVyaWZpZWQ7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIGRlbGV0ZURyYXdpbmcobmV3RmlsZW5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBmaWxlczogc3RyaW5nW10gPSBmcy5yZWFkZGlyU3luYyhTVE9SQUdFX0RJUik7XG4gICAgICAgIGlmIChmaWxlcy5pbmNsdWRlcyhuZXdGaWxlbmFtZSkpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY29sbGVjdGlvbi5maW5kT25lQW5kRGVsZXRlKHsgZmlsZW5hbWU6IG5ld0ZpbGVuYW1lIH0pO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKFNUT1JBR0VfRElSICsgbmV3RmlsZW5hbWUpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQcm9ibMOobWUgbG9ycyBkZSBsYSBzdXBwcmVzc2lvbiBkZSBsJ2ltYWdlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgdGhyb3cgbmV3IEVycm9yKCdJbWFnZSBpbnRyb3V2YWJsZScpO1xuICAgIH1cblxuICAgIGNoZWNrTmFtZShuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIFJFR0VYX1RJVExFLnRlc3QobmFtZSk7XG4gICAgfVxuXG4gICAgY2hlY2tUYWdzKHRhZ3M6IHN0cmluZ1tdKTogYm9vbGVhbiB7XG4gICAgICAgIGxldCB2YWxpZFRhZ0xpc3QgPSB0cnVlO1xuICAgICAgICBsZXQgdGFnQ3RyID0gMDtcbiAgICAgICAgdGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICghUkVHRVhfVEFHLnRlc3QodGFnKSkge1xuICAgICAgICAgICAgICAgIHZhbGlkVGFnTGlzdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFnQ3RyKys7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdmFsaWRUYWdMaXN0ICYmIHRhZ0N0ciA8PSBNQVhfVEFHUztcbiAgICB9XG5cbiAgICBjaGVja01ldGFEYXRhKG1ldGFEYXRhOiBNZXRhRGF0YSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBjb250YWluc1ZhbGlkVGl0bGUgPSB0aGlzLmNoZWNrTmFtZShtZXRhRGF0YS5uYW1lKTtcbiAgICAgICAgY29uc3QgY29udGFpbnNDb3JyZWN0VGFncyA9IHRoaXMuY2hlY2tUYWdzKG1ldGFEYXRhLnRhZ3MpO1xuICAgICAgICByZXR1cm4gY29udGFpbnNWYWxpZFRpdGxlICYmIGNvbnRhaW5zQ29ycmVjdFRhZ3M7XG4gICAgfVxufVxuIl19