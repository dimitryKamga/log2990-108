"use strict";function cov_ej77p9x2a(){var path="C:\\Users\\USER\\Documents\\GitHub\\log2990-108\\server\\app\\services\\database.service.ts";var hash="3fd36347067465109eb7ee59d0e4edb6dd42a659";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\USER\\Documents\\GitHub\\log2990-108\\server\\app\\services\\database.service.ts",statementMap:{"0":{start:{line:2,column:17},end:{line:7,column:1}},"1":{start:{line:3,column:12},end:{line:3,column:28}},"2":{start:{line:3,column:34},end:{line:3,column:125}},"3":{start:{line:4,column:4},end:{line:5,column:150}},"4":{start:{line:4,column:79},end:{line:4,column:131}},"5":{start:{line:5,column:9},end:{line:5,column:150}},"6":{start:{line:5,column:22},end:{line:5,column:43}},"7":{start:{line:5,column:58},end:{line:5,column:150}},"8":{start:{line:5,column:81},end:{line:5,column:150}},"9":{start:{line:6,column:4},end:{line:6,column:66}},"10":{start:{line:8,column:16},end:{line:16,column:1}},"11":{start:{line:9,column:28},end:{line:9,column:110}},"12":{start:{line:9,column:91},end:{line:9,column:106}},"13":{start:{line:10,column:4},end:{line:15,column:7}},"14":{start:{line:11,column:36},end:{line:11,column:97}},"15":{start:{line:11,column:42},end:{line:11,column:70}},"16":{start:{line:11,column:85},end:{line:11,column:95}},"17":{start:{line:12,column:35},end:{line:12,column:100}},"18":{start:{line:12,column:41},end:{line:12,column:73}},"19":{start:{line:12,column:88},end:{line:12,column:98}},"20":{start:{line:13,column:32},end:{line:13,column:116}},"21":{start:{line:14,column:8},end:{line:14,column:78}},"22":{start:{line:17,column:0},end:{line:17,column:62}},"23":{start:{line:18,column:0},end:{line:18,column:33}},"24":{start:{line:19,column:20},end:{line:19,column:45}},"25":{start:{line:20,column:11},end:{line:20,column:24}},"26":{start:{line:21,column:20},end:{line:21,column:40}},"27":{start:{line:22,column:18},end:{line:22,column:36}},"28":{start:{line:23,column:15},end:{line:23,column:32}},"29":{start:{line:24,column:0},end:{line:24,column:28}},"30":{start:{line:25,column:22},end:{line:120,column:1}},"31":{start:{line:27,column:8},end:{line:30,column:10}},"32":{start:{line:33,column:8},end:{line:33,column:144}},"33":{start:{line:34,column:8},end:{line:41,column:11}},"34":{start:{line:36,column:12},end:{line:36,column:33}},"35":{start:{line:37,column:12},end:{line:37,column:111}},"36":{start:{line:40,column:12},end:{line:40,column:71}},"37":{start:{line:44,column:8},end:{line:44,column:40}},"38":{start:{line:47,column:8},end:{line:47,column:39}},"39":{start:{line:50,column:8},end:{line:50,column:56}},"40":{start:{line:51,column:8},end:{line:51,column:33}},"41":{start:{line:54,column:8},end:{line:66,column:11}},"42":{start:{line:55,column:12},end:{line:65,column:13}},"43":{start:{line:56,column:16},end:{line:56,column:58}},"44":{start:{line:59,column:16},end:{line:64,column:17}},"45":{start:{line:60,column:20},end:{line:60,column:76}},"46":{start:{line:63,column:20},end:{line:63,column:63}},"47":{start:{line:69,column:8},end:{line:83,column:11}},"48":{start:{line:70,column:12},end:{line:70,column:70}},"49":{start:{line:71,column:30},end:{line:71,column:32}},"50":{start:{line:72,column:12},end:{line:82,column:15}},"51":{start:{line:76,column:16},end:{line:80,column:17}},"52":{start:{line:77,column:20},end:{line:79,column:21}},"53":{start:{line:78,column:24},end:{line:78,column:45}},"54":{start:{line:81,column:16},end:{line:81,column:33}},"55":{start:{line:86,column:8},end:{line:99,column:11}},"56":{start:{line:87,column:12},end:{line:87,column:70}},"57":{start:{line:88,column:12},end:{line:98,column:49}},"58":{start:{line:89,column:16},end:{line:89,column:82}},"59":{start:{line:90,column:16},end:{line:95,column:17}},"60":{start:{line:91,column:20},end:{line:91,column:70}},"61":{start:{line:94,column:20},end:{line:94,column:63}},"62":{start:{line:98,column:16},end:{line:98,column:49}},"63":{start:{line:102,column:8},end:{line:102,column:50}},"64":{start:{line:105,column:27},end:{line:105,column:31}},"65":{start:{line:106,column:21},end:{line:106,column:22}},"66":{start:{line:107,column:8},end:{line:112,column:11}},"67":{start:{line:108,column:12},end:{line:110,column:13}},"68":{start:{line:109,column:16},end:{line:109,column:37}},"69":{start:{line:111,column:12},end:{line:111,column:21}},"70":{start:{line:113,column:8},end:{line:113,column:62}},"71":{start:{line:116,column:35},end:{line:116,column:64}},"72":{start:{line:117,column:36},end:{line:117,column:65}},"73":{start:{line:118,column:8},end:{line:118,column:57}},"74":{start:{line:121,column:0},end:{line:123,column:20}},"75":{start:{line:124,column:0},end:{line:124,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:46},end:{line:2,column:47}},loc:{start:{line:2,column:87},end:{line:7,column:1}},line:2},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:44},end:{line:8,column:45}},loc:{start:{line:8,column:89},end:{line:16,column:1}},line:8},"2":{name:"adopt",decl:{start:{line:9,column:13},end:{line:9,column:18}},loc:{start:{line:9,column:26},end:{line:9,column:112}},line:9},"3":{name:"(anonymous_3)",decl:{start:{line:9,column:70},end:{line:9,column:71}},loc:{start:{line:9,column:89},end:{line:9,column:108}},line:9},"4":{name:"(anonymous_4)",decl:{start:{line:10,column:36},end:{line:10,column:37}},loc:{start:{line:10,column:63},end:{line:15,column:5}},line:10},"5":{name:"fulfilled",decl:{start:{line:11,column:17},end:{line:11,column:26}},loc:{start:{line:11,column:34},end:{line:11,column:99}},line:11},"6":{name:"rejected",decl:{start:{line:12,column:17},end:{line:12,column:25}},loc:{start:{line:12,column:33},end:{line:12,column:102}},line:12},"7":{name:"step",decl:{start:{line:13,column:17},end:{line:13,column:21}},loc:{start:{line:13,column:30},end:{line:13,column:118}},line:13},"8":{name:"(anonymous_8)",decl:{start:{line:26,column:4},end:{line:26,column:5}},loc:{start:{line:26,column:18},end:{line:31,column:5}},line:26},"9":{name:"(anonymous_9)",decl:{start:{line:32,column:4},end:{line:32,column:5}},loc:{start:{line:32,column:42},end:{line:42,column:5}},line:32},"10":{name:"(anonymous_10)",decl:{start:{line:35,column:18},end:{line:35,column:19}},loc:{start:{line:35,column:30},end:{line:38,column:9}},line:35},"11":{name:"(anonymous_11)",decl:{start:{line:39,column:19},end:{line:39,column:20}},loc:{start:{line:39,column:30},end:{line:41,column:9}},line:39},"12":{name:"(anonymous_12)",decl:{start:{line:43,column:4},end:{line:43,column:5}},loc:{start:{line:43,column:25},end:{line:45,column:5}},line:43},"13":{name:"(anonymous_13)",decl:{start:{line:46,column:4},end:{line:46,column:5}},loc:{start:{line:46,column:20},end:{line:48,column:5}},line:46},"14":{name:"(anonymous_14)",decl:{start:{line:49,column:4},end:{line:49,column:5}},loc:{start:{line:49,column:34},end:{line:52,column:5}},line:49},"15":{name:"(anonymous_15)",decl:{start:{line:53,column:4},end:{line:53,column:5}},loc:{start:{line:53,column:26},end:{line:67,column:5}},line:53},"16":{name:"(anonymous_16)",decl:{start:{line:54,column:47},end:{line:54,column:48}},loc:{start:{line:54,column:60},end:{line:66,column:9}},line:54},"17":{name:"(anonymous_17)",decl:{start:{line:68,column:4},end:{line:68,column:5}},loc:{start:{line:68,column:18},end:{line:84,column:5}},line:68},"18":{name:"(anonymous_18)",decl:{start:{line:69,column:47},end:{line:69,column:48}},loc:{start:{line:69,column:60},end:{line:83,column:9}},line:69},"19":{name:"(anonymous_19)",decl:{start:{line:75,column:22},end:{line:75,column:23}},loc:{start:{line:75,column:37},end:{line:82,column:13}},line:75},"20":{name:"(anonymous_20)",decl:{start:{line:85,column:4},end:{line:85,column:5}},loc:{start:{line:85,column:31},end:{line:100,column:5}},line:85},"21":{name:"(anonymous_21)",decl:{start:{line:86,column:47},end:{line:86,column:48}},loc:{start:{line:86,column:60},end:{line:99,column:9}},line:86},"22":{name:"(anonymous_22)",decl:{start:{line:101,column:4},end:{line:101,column:5}},loc:{start:{line:101,column:20},end:{line:103,column:5}},line:101},"23":{name:"(anonymous_23)",decl:{start:{line:104,column:4},end:{line:104,column:5}},loc:{start:{line:104,column:20},end:{line:114,column:5}},line:104},"24":{name:"(anonymous_24)",decl:{start:{line:107,column:21},end:{line:107,column:22}},loc:{start:{line:107,column:30},end:{line:112,column:9}},line:107},"25":{name:"(anonymous_25)",decl:{start:{line:115,column:4},end:{line:115,column:5}},loc:{start:{line:115,column:28},end:{line:119,column:5}},line:115}},branchMap:{"0":{loc:{start:{line:2,column:17},end:{line:7,column:1}},type:"binary-expr",locations:[{start:{line:2,column:18},end:{line:2,column:22}},{start:{line:2,column:26},end:{line:2,column:41}},{start:{line:2,column:46},end:{line:7,column:1}}],line:2},"1":{loc:{start:{line:3,column:34},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:42},end:{line:3,column:48}},{start:{line:3,column:51},end:{line:3,column:125}}],line:3},"2":{loc:{start:{line:3,column:51},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:67},end:{line:3,column:118}},{start:{line:3,column:121},end:{line:3,column:125}}],line:3},"3":{loc:{start:{line:4,column:4},end:{line:5,column:150}},type:"if",locations:[{start:{line:4,column:4},end:{line:5,column:150}},{start:{line:4,column:4},end:{line:5,column:150}}],line:4},"4":{loc:{start:{line:4,column:8},end:{line:4,column:77}},type:"binary-expr",locations:[{start:{line:4,column:8},end:{line:4,column:35}},{start:{line:4,column:39},end:{line:4,column:77}}],line:4},"5":{loc:{start:{line:5,column:58},end:{line:5,column:150}},type:"if",locations:[{start:{line:5,column:58},end:{line:5,column:150}},{start:{line:5,column:58},end:{line:5,column:150}}],line:5},"6":{loc:{start:{line:5,column:85},end:{line:5,column:149}},type:"binary-expr",locations:[{start:{line:5,column:86},end:{line:5,column:143}},{start:{line:5,column:148},end:{line:5,column:149}}],line:5},"7":{loc:{start:{line:5,column:86},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:94},end:{line:5,column:98}},{start:{line:5,column:101},end:{line:5,column:143}}],line:5},"8":{loc:{start:{line:5,column:101},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:109},end:{line:5,column:126}},{start:{line:5,column:129},end:{line:5,column:143}}],line:5},"9":{loc:{start:{line:6,column:11},end:{line:6,column:62}},type:"binary-expr",locations:[{start:{line:6,column:11},end:{line:6,column:16}},{start:{line:6,column:20},end:{line:6,column:21}},{start:{line:6,column:25},end:{line:6,column:62}}],line:6},"10":{loc:{start:{line:8,column:16},end:{line:16,column:1}},type:"binary-expr",locations:[{start:{line:8,column:17},end:{line:8,column:21}},{start:{line:8,column:25},end:{line:8,column:39}},{start:{line:8,column:44},end:{line:16,column:1}}],line:8},"11":{loc:{start:{line:9,column:35},end:{line:9,column:109}},type:"cond-expr",locations:[{start:{line:9,column:56},end:{line:9,column:61}},{start:{line:9,column:64},end:{line:9,column:109}}],line:9},"12":{loc:{start:{line:10,column:16},end:{line:10,column:34}},type:"binary-expr",locations:[{start:{line:10,column:16},end:{line:10,column:17}},{start:{line:10,column:22},end:{line:10,column:33}}],line:10},"13":{loc:{start:{line:13,column:32},end:{line:13,column:115}},type:"cond-expr",locations:[{start:{line:13,column:46},end:{line:13,column:67}},{start:{line:13,column:70},end:{line:13,column:115}}],line:13},"14":{loc:{start:{line:14,column:51},end:{line:14,column:67}},type:"binary-expr",locations:[{start:{line:14,column:51},end:{line:14,column:61}},{start:{line:14,column:65},end:{line:14,column:67}}],line:14},"15":{loc:{start:{line:32,column:10},end:{line:32,column:40}},type:"default-arg",locations:[{start:{line:32,column:16},end:{line:32,column:40}}],line:32},"16":{loc:{start:{line:33,column:8},end:{line:33,column:143}},type:"cond-expr",locations:[{start:{line:33,column:47},end:{line:33,column:81}},{start:{line:33,column:85},end:{line:33,column:142}}],line:33},"17":{loc:{start:{line:55,column:12},end:{line:65,column:13}},type:"if",locations:[{start:{line:55,column:12},end:{line:65,column:13}},{start:{line:55,column:12},end:{line:65,column:13}}],line:55},"18":{loc:{start:{line:77,column:20},end:{line:79,column:21}},type:"if",locations:[{start:{line:77,column:20},end:{line:79,column:21}},{start:{line:77,column:20},end:{line:79,column:21}}],line:77},"19":{loc:{start:{line:88,column:12},end:{line:98,column:49}},type:"if",locations:[{start:{line:88,column:12},end:{line:98,column:49}},{start:{line:88,column:12},end:{line:98,column:49}}],line:88},"20":{loc:{start:{line:108,column:12},end:{line:110,column:13}},type:"if",locations:[{start:{line:108,column:12},end:{line:110,column:13}},{start:{line:108,column:12},end:{line:110,column:13}}],line:108},"21":{loc:{start:{line:113,column:15},end:{line:113,column:61}},type:"binary-expr",locations:[{start:{line:113,column:15},end:{line:113,column:27}},{start:{line:113,column:31},end:{line:113,column:61}}],line:113},"22":{loc:{start:{line:118,column:15},end:{line:118,column:56}},type:"binary-expr",locations:[{start:{line:118,column:15},end:{line:118,column:33}},{start:{line:118,column:37},end:{line:118,column:56}}],line:118}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},inputSourceMap:{version:3,file:"C:/Users/USER/Documents/GitHub/log2990-108/server/app/services/database.service.ts",sources:["C:/Users/USER/Documents/GitHub/log2990-108/server/app/services/database.service.ts"],names:[],mappings:"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",sourcesContent:["import { DATABASE_COLLECTION, DATABASE_NAME, DATABASE_URL, MAX_TAGS, REGEX_TAG, REGEX_TITLE, STORAGE_DIR, STORAGE_PATH } from '@app/constants';\nimport { MetaData } from '@common/communication/metadata';\nimport * as fs from 'fs';\nimport { injectable } from 'inversify';\nimport { Collection, MongoClient, MongoClientOptions } from 'mongodb';\nimport * as multer from 'multer';\nimport 'reflect-metadata';\n\n\n@injectable()\nexport class DatabaseService {\n    client: MongoClient;\n    collection: Collection<MetaData>;\n    multerObject: multer.Multer;\n    localDrawings: string[];\n\n    private options: MongoClientOptions = {\n        useNewUrlParser: true,\n        useUnifiedTopology: true,\n    };\n\n    start(url: string = DATABASE_URL) {\n        !fs.existsSync(this.getStorageDir()) ? fs.mkdirSync(this.getStorageDir()) : (this.localDrawings = fs.readdirSync(this.getStorageDir()));\n        MongoClient.connect(url, this.options)\n            .then((client: MongoClient) => {\n                this.client = client;\n                this.collection = client.db(DATABASE_NAME).collection(DATABASE_COLLECTION);\n            })\n            .catch((error: Error) => {\n                console.log((error.message = 'Database connection error'));\n            });\n    }\n\n    getStorageRootPath(): string {\n        return STORAGE_PATH;\n    }\n\n    getStorageDir(): string {\n        return STORAGE_DIR;\n    }\n\n    createMulterUpload(directory: string): multer.Multer {\n        this.multerObject = multer({ dest: directory });\n        return this.multerObject;\n    }\n\n    async postDrawing(metaData: MetaData): Promise<void> {\n        if (this.checkMetaData(metaData)) {\n            await this.collection.insertOne(metaData);\n        } else {\n            try {\n                fs.unlinkSync(this.getStorageDir() + metaData.filename);\n            } catch (error) {\n                throw new Error('M\xE9tadonn\xE9es non valides');\n            }\n        }\n    }\n\n    async getMetaData(): Promise<MetaData[]> {\n        this.localDrawings = fs.readdirSync(this.getStorageDir());\n        const metadatas: MetaData[] = [];\n        return this.collection\n            .find({})\n            .toArray()\n            .then((metaDatas: MetaData[]) => {\n                for (const meta of metaDatas) {\n                    if (this.localDrawings.includes(meta.filename)) {\n                        metadatas.push(meta);\n                    }\n                }\n                return metadatas;\n            });\n    }\n\n    async deleteDrawing(newFilename: string): Promise<void> {\n        this.localDrawings = fs.readdirSync(this.getStorageDir());\n        if (this.localDrawings.includes(newFilename)) {\n            await this.collection.findOneAndDelete({ filename: newFilename });\n            try {\n                fs.unlinkSync(this.getStorageDir() + newFilename);\n            } catch (error) {\n                throw new Error('Impossible de Supprimer');\n            }\n        } else throw new Error('Dessin Absent');\n    }\n\n    checkName(name: string): boolean {\n        return REGEX_TITLE.test(name);\n    }\n\n    checkTags(tags: string[]): boolean {\n        let validTagList = true;\n        let tagCtr = 0;\n        tags.forEach((tag) => {\n            if (!REGEX_TAG.test(tag)) {\n                validTagList = false;\n            }\n            tagCtr++;\n        });\n        return validTagList && tagCtr <= MAX_TAGS;\n    }\n\n    checkMetaData(metaData: MetaData): boolean {\n        const containsValidTitle = this.checkName(metaData.name);\n        const containsCorrectTags = this.checkTags(metaData.tags);\n        return containsValidTitle && containsCorrectTags;\n    }\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"3fd36347067465109eb7ee59d0e4edb6dd42a659"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_ej77p9x2a=function(){return actualCoverage;};}return actualCoverage;}cov_ej77p9x2a();var __decorate=(cov_ej77p9x2a().s[0]++,(cov_ej77p9x2a().b[0][0]++,this)&&(cov_ej77p9x2a().b[0][1]++,this.__decorate)||(cov_ej77p9x2a().b[0][2]++,function(decorators,target,key,desc){cov_ej77p9x2a().f[0]++;var c=(cov_ej77p9x2a().s[1]++,arguments.length),r=(cov_ej77p9x2a().s[2]++,c<3?(cov_ej77p9x2a().b[1][0]++,target):(cov_ej77p9x2a().b[1][1]++,desc===null?(cov_ej77p9x2a().b[2][0]++,desc=Object.getOwnPropertyDescriptor(target,key)):(cov_ej77p9x2a().b[2][1]++,desc))),d;cov_ej77p9x2a().s[3]++;if((cov_ej77p9x2a().b[4][0]++,typeof Reflect==="object")&&(cov_ej77p9x2a().b[4][1]++,typeof Reflect.decorate==="function")){cov_ej77p9x2a().b[3][0]++;cov_ej77p9x2a().s[4]++;r=Reflect.decorate(decorators,target,key,desc);}else{cov_ej77p9x2a().b[3][1]++;cov_ej77p9x2a().s[5]++;for(var i=(cov_ej77p9x2a().s[6]++,decorators.length-1);i>=0;i--){cov_ej77p9x2a().s[7]++;if(d=decorators[i]){cov_ej77p9x2a().b[5][0]++;cov_ej77p9x2a().s[8]++;r=(cov_ej77p9x2a().b[6][0]++,c<3?(cov_ej77p9x2a().b[7][0]++,d(r)):(cov_ej77p9x2a().b[7][1]++,c>3?(cov_ej77p9x2a().b[8][0]++,d(target,key,r)):(cov_ej77p9x2a().b[8][1]++,d(target,key))))||(cov_ej77p9x2a().b[6][1]++,r);}else{cov_ej77p9x2a().b[5][1]++;}}}cov_ej77p9x2a().s[9]++;return(cov_ej77p9x2a().b[9][0]++,c>3)&&(cov_ej77p9x2a().b[9][1]++,r)&&(cov_ej77p9x2a().b[9][2]++,Object.defineProperty(target,key,r)),r;}));var __awaiter=(cov_ej77p9x2a().s[10]++,(cov_ej77p9x2a().b[10][0]++,this)&&(cov_ej77p9x2a().b[10][1]++,this.__awaiter)||(cov_ej77p9x2a().b[10][2]++,function(thisArg,_arguments,P,generator){cov_ej77p9x2a().f[1]++;function adopt(value){cov_ej77p9x2a().f[2]++;cov_ej77p9x2a().s[11]++;return value instanceof P?(cov_ej77p9x2a().b[11][0]++,value):(cov_ej77p9x2a().b[11][1]++,new P(function(resolve){cov_ej77p9x2a().f[3]++;cov_ej77p9x2a().s[12]++;resolve(value);}));}cov_ej77p9x2a().s[13]++;return new((cov_ej77p9x2a().b[12][0]++,P)||(cov_ej77p9x2a().b[12][1]++,P=Promise))(function(resolve,reject){cov_ej77p9x2a().f[4]++;function fulfilled(value){cov_ej77p9x2a().f[5]++;cov_ej77p9x2a().s[14]++;try{cov_ej77p9x2a().s[15]++;step(generator.next(value));}catch(e){cov_ej77p9x2a().s[16]++;reject(e);}}function rejected(value){cov_ej77p9x2a().f[6]++;cov_ej77p9x2a().s[17]++;try{cov_ej77p9x2a().s[18]++;step(generator["throw"](value));}catch(e){cov_ej77p9x2a().s[19]++;reject(e);}}function step(result){cov_ej77p9x2a().f[7]++;cov_ej77p9x2a().s[20]++;result.done?(cov_ej77p9x2a().b[13][0]++,resolve(result.value)):(cov_ej77p9x2a().b[13][1]++,adopt(result.value).then(fulfilled,rejected));}cov_ej77p9x2a().s[21]++;step((generator=generator.apply(thisArg,(cov_ej77p9x2a().b[14][0]++,_arguments)||(cov_ej77p9x2a().b[14][1]++,[]))).next());});}));cov_ej77p9x2a().s[22]++;Object.defineProperty(exports,"__esModule",{value:true});cov_ej77p9x2a().s[23]++;exports.DatabaseService=void 0;const constants_1=(cov_ej77p9x2a().s[24]++,require("@app/constants"));const fs=(cov_ej77p9x2a().s[25]++,require("fs"));const inversify_1=(cov_ej77p9x2a().s[26]++,require("inversify"));const mongodb_1=(cov_ej77p9x2a().s[27]++,require("mongodb"));const multer=(cov_ej77p9x2a().s[28]++,require("multer"));cov_ej77p9x2a().s[29]++;require("reflect-metadata");cov_ej77p9x2a().s[30]++;let DatabaseService=class DatabaseService{constructor(){cov_ej77p9x2a().f[8]++;cov_ej77p9x2a().s[31]++;this.options={useNewUrlParser:true,useUnifiedTopology:true};}start(url=(cov_ej77p9x2a().b[15][0]++,constants_1.DATABASE_URL)){cov_ej77p9x2a().f[9]++;cov_ej77p9x2a().s[32]++;!fs.existsSync(this.getStorageDir())?(cov_ej77p9x2a().b[16][0]++,fs.mkdirSync(this.getStorageDir())):(cov_ej77p9x2a().b[16][1]++,this.localDrawings=fs.readdirSync(this.getStorageDir()));cov_ej77p9x2a().s[33]++;mongodb_1.MongoClient.connect(url,this.options).then(client=>{cov_ej77p9x2a().f[10]++;cov_ej77p9x2a().s[34]++;this.client=client;cov_ej77p9x2a().s[35]++;this.collection=client.db(constants_1.DATABASE_NAME).collection(constants_1.DATABASE_COLLECTION);}).catch(error=>{cov_ej77p9x2a().f[11]++;cov_ej77p9x2a().s[36]++;console.log(error.message='Database connection error');});}getStorageRootPath(){cov_ej77p9x2a().f[12]++;cov_ej77p9x2a().s[37]++;return constants_1.STORAGE_PATH;}getStorageDir(){cov_ej77p9x2a().f[13]++;cov_ej77p9x2a().s[38]++;return constants_1.STORAGE_DIR;}createMulterUpload(directory){cov_ej77p9x2a().f[14]++;cov_ej77p9x2a().s[39]++;this.multerObject=multer({dest:directory});cov_ej77p9x2a().s[40]++;return this.multerObject;}postDrawing(metaData){cov_ej77p9x2a().f[15]++;cov_ej77p9x2a().s[41]++;return __awaiter(this,void 0,void 0,function*(){cov_ej77p9x2a().f[16]++;cov_ej77p9x2a().s[42]++;if(this.checkMetaData(metaData)){cov_ej77p9x2a().b[17][0]++;cov_ej77p9x2a().s[43]++;yield this.collection.insertOne(metaData);}else{cov_ej77p9x2a().b[17][1]++;cov_ej77p9x2a().s[44]++;try{cov_ej77p9x2a().s[45]++;fs.unlinkSync(this.getStorageDir()+metaData.filename);}catch(error){cov_ej77p9x2a().s[46]++;throw new Error('Métadonnées non valides');}}});}getMetaData(){cov_ej77p9x2a().f[17]++;cov_ej77p9x2a().s[47]++;return __awaiter(this,void 0,void 0,function*(){cov_ej77p9x2a().f[18]++;cov_ej77p9x2a().s[48]++;this.localDrawings=fs.readdirSync(this.getStorageDir());const metadatas=(cov_ej77p9x2a().s[49]++,[]);cov_ej77p9x2a().s[50]++;return this.collection.find({}).toArray().then(metaDatas=>{cov_ej77p9x2a().f[19]++;cov_ej77p9x2a().s[51]++;for(const meta of metaDatas){cov_ej77p9x2a().s[52]++;if(this.localDrawings.includes(meta.filename)){cov_ej77p9x2a().b[18][0]++;cov_ej77p9x2a().s[53]++;metadatas.push(meta);}else{cov_ej77p9x2a().b[18][1]++;}}cov_ej77p9x2a().s[54]++;return metadatas;});});}deleteDrawing(newFilename){cov_ej77p9x2a().f[20]++;cov_ej77p9x2a().s[55]++;return __awaiter(this,void 0,void 0,function*(){cov_ej77p9x2a().f[21]++;cov_ej77p9x2a().s[56]++;this.localDrawings=fs.readdirSync(this.getStorageDir());cov_ej77p9x2a().s[57]++;if(this.localDrawings.includes(newFilename)){cov_ej77p9x2a().b[19][0]++;cov_ej77p9x2a().s[58]++;yield this.collection.findOneAndDelete({filename:newFilename});cov_ej77p9x2a().s[59]++;try{cov_ej77p9x2a().s[60]++;fs.unlinkSync(this.getStorageDir()+newFilename);}catch(error){cov_ej77p9x2a().s[61]++;throw new Error('Impossible de Supprimer');}}else{cov_ej77p9x2a().b[19][1]++;cov_ej77p9x2a().s[62]++;throw new Error('Dessin Absent');}});}checkName(name){cov_ej77p9x2a().f[22]++;cov_ej77p9x2a().s[63]++;return constants_1.REGEX_TITLE.test(name);}checkTags(tags){cov_ej77p9x2a().f[23]++;let validTagList=(cov_ej77p9x2a().s[64]++,true);let tagCtr=(cov_ej77p9x2a().s[65]++,0);cov_ej77p9x2a().s[66]++;tags.forEach(tag=>{cov_ej77p9x2a().f[24]++;cov_ej77p9x2a().s[67]++;if(!constants_1.REGEX_TAG.test(tag)){cov_ej77p9x2a().b[20][0]++;cov_ej77p9x2a().s[68]++;validTagList=false;}else{cov_ej77p9x2a().b[20][1]++;}cov_ej77p9x2a().s[69]++;tagCtr++;});cov_ej77p9x2a().s[70]++;return(cov_ej77p9x2a().b[21][0]++,validTagList)&&(cov_ej77p9x2a().b[21][1]++,tagCtr<=constants_1.MAX_TAGS);}checkMetaData(metaData){cov_ej77p9x2a().f[25]++;const containsValidTitle=(cov_ej77p9x2a().s[71]++,this.checkName(metaData.name));const containsCorrectTags=(cov_ej77p9x2a().s[72]++,this.checkTags(metaData.tags));cov_ej77p9x2a().s[73]++;return(cov_ej77p9x2a().b[22][0]++,containsValidTitle)&&(cov_ej77p9x2a().b[22][1]++,containsCorrectTags);}};cov_ej77p9x2a().s[74]++;DatabaseService=__decorate([inversify_1.injectable()],DatabaseService);cov_ej77p9x2a().s[75]++;exports.DatabaseService=DatabaseService;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvVVNFUi9Eb2N1bWVudHMvR2l0SHViL2xvZzI5OTAtMTA4L3NlcnZlci9hcHAvc2VydmljZXMvZGF0YWJhc2Uuc2VydmljZS50cyIsInNvdXJjZXMiOlsiQzovVXNlcnMvVVNFUi9Eb2N1bWVudHMvR2l0SHViL2xvZzI5OTAtMTA4L3NlcnZlci9hcHAvc2VydmljZXMvZGF0YWJhc2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBK0k7QUFFL0kseUJBQXlCO0FBQ3pCLHlDQUF1QztBQUN2QyxxQ0FBc0U7QUFDdEUsaUNBQWlDO0FBQ2pDLDRCQUEwQjtBQUkxQixJQUFhLGVBQWUsR0FBNUIsTUFBYSxlQUFlO0lBQTVCO1FBTVksWUFBTyxHQUF1QjtZQUNsQyxlQUFlLEVBQUUsSUFBSTtZQUNyQixrQkFBa0IsRUFBRSxJQUFJO1NBQzNCLENBQUM7SUF3Rk4sQ0FBQztJQXRGRyxLQUFLLENBQUMsTUFBYyx3QkFBWTtRQUM1QixDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEkscUJBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUM7YUFDakMsSUFBSSxDQUFDLENBQUMsTUFBbUIsRUFBRSxFQUFFO1lBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyx5QkFBYSxDQUFDLENBQUMsVUFBVSxDQUFDLCtCQUFtQixDQUFDLENBQUM7UUFD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QUksQ0FBQyxxQkFBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDdEIsWUFBWSxHQUFHLEtBQUssQ0FBQzthQUN4QjtZQUNELE1BQU0sRUFBRSxDQUFDO1FBQ2IsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLFlBQVksSUFBSSxNQUFNLElBQUksb0JBQVEsQ0FBQztJQUM5QyxDQUFDO0lBRUQsYUFBYSxDQUFDLFFBQWtCO1FBQzVCLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxRCxPQUFPLGtCQUFrQixJQUFJLG1CQUFtQixDQUFDO0lBQ3JELENBQUM7Q0FDSixDQUFBO0FBakdZLGVBQWU7SUFEM0Isc0JBQVUsRUFBRTtHQUNBLGVBQWUsQ0FpRzNCO0FBakdZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREFUQUJBU0VfQ09MTEVDVElPTiwgREFUQUJBU0VfTkFNRSwgREFUQUJBU0VfVVJMLCBNQVhfVEFHUywgUkVHRVhfVEFHLCBSRUdFWF9USVRMRSwgU1RPUkFHRV9ESVIsIFNUT1JBR0VfUEFUSCB9IGZyb20gJ0BhcHAvY29uc3RhbnRzJztcbmltcG9ydCB7IE1ldGFEYXRhIH0gZnJvbSAnQGNvbW1vbi9jb21tdW5pY2F0aW9uL21ldGFkYXRhJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCB7IGluamVjdGFibGUgfSBmcm9tICdpbnZlcnNpZnknO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgTW9uZ29DbGllbnQsIE1vbmdvQ2xpZW50T3B0aW9ucyB9IGZyb20gJ21vbmdvZGInO1xuaW1wb3J0ICogYXMgbXVsdGVyIGZyb20gJ211bHRlcic7XG5pbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuXG5cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEYXRhYmFzZVNlcnZpY2Uge1xuICAgIGNsaWVudDogTW9uZ29DbGllbnQ7XG4gICAgY29sbGVjdGlvbjogQ29sbGVjdGlvbjxNZXRhRGF0YT47XG4gICAgbXVsdGVyT2JqZWN0OiBtdWx0ZXIuTXVsdGVyO1xuICAgIGxvY2FsRHJhd2luZ3M6IHN0cmluZ1tdO1xuXG4gICAgcHJpdmF0ZSBvcHRpb25zOiBNb25nb0NsaWVudE9wdGlvbnMgPSB7XG4gICAgICAgIHVzZU5ld1VybFBhcnNlcjogdHJ1ZSxcbiAgICAgICAgdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlLFxuICAgIH07XG5cbiAgICBzdGFydCh1cmw6IHN0cmluZyA9IERBVEFCQVNFX1VSTCkge1xuICAgICAgICAhZnMuZXhpc3RzU3luYyh0aGlzLmdldFN0b3JhZ2VEaXIoKSkgPyBmcy5ta2RpclN5bmModGhpcy5nZXRTdG9yYWdlRGlyKCkpIDogKHRoaXMubG9jYWxEcmF3aW5ncyA9IGZzLnJlYWRkaXJTeW5jKHRoaXMuZ2V0U3RvcmFnZURpcigpKSk7XG4gICAgICAgIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCB0aGlzLm9wdGlvbnMpXG4gICAgICAgICAgICAudGhlbigoY2xpZW50OiBNb25nb0NsaWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50O1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IGNsaWVudC5kYihEQVRBQkFTRV9OQU1FKS5jb2xsZWN0aW9uKERBVEFCQVNFX0NPTExFQ1RJT04pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3I6IEVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coKGVycm9yLm1lc3NhZ2UgPSAnRGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvcicpKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldFN0b3JhZ2VSb290UGF0aCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gU1RPUkFHRV9QQVRIO1xuICAgIH1cblxuICAgIGdldFN0b3JhZ2VEaXIoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIFNUT1JBR0VfRElSO1xuICAgIH1cblxuICAgIGNyZWF0ZU11bHRlclVwbG9hZChkaXJlY3Rvcnk6IHN0cmluZyk6IG11bHRlci5NdWx0ZXIge1xuICAgICAgICB0aGlzLm11bHRlck9iamVjdCA9IG11bHRlcih7IGRlc3Q6IGRpcmVjdG9yeSB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMubXVsdGVyT2JqZWN0O1xuICAgIH1cblxuICAgIGFzeW5jIHBvc3REcmF3aW5nKG1ldGFEYXRhOiBNZXRhRGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAodGhpcy5jaGVja01ldGFEYXRhKG1ldGFEYXRhKSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmluc2VydE9uZShtZXRhRGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGZzLnVubGlua1N5bmModGhpcy5nZXRTdG9yYWdlRGlyKCkgKyBtZXRhRGF0YS5maWxlbmFtZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTcOpdGFkb25uw6llcyBub24gdmFsaWRlcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0TWV0YURhdGEoKTogUHJvbWlzZTxNZXRhRGF0YVtdPiB7XG4gICAgICAgIHRoaXMubG9jYWxEcmF3aW5ncyA9IGZzLnJlYWRkaXJTeW5jKHRoaXMuZ2V0U3RvcmFnZURpcigpKTtcbiAgICAgICAgY29uc3QgbWV0YWRhdGFzOiBNZXRhRGF0YVtdID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmNvbGxlY3Rpb25cbiAgICAgICAgICAgIC5maW5kKHt9KVxuICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgLnRoZW4oKG1ldGFEYXRhczogTWV0YURhdGFbXSkgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbWV0YSBvZiBtZXRhRGF0YXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9jYWxEcmF3aW5ncy5pbmNsdWRlcyhtZXRhLmZpbGVuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGFzLnB1c2gobWV0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhcztcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIGRlbGV0ZURyYXdpbmcobmV3RmlsZW5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0aGlzLmxvY2FsRHJhd2luZ3MgPSBmcy5yZWFkZGlyU3luYyh0aGlzLmdldFN0b3JhZ2VEaXIoKSk7XG4gICAgICAgIGlmICh0aGlzLmxvY2FsRHJhd2luZ3MuaW5jbHVkZXMobmV3RmlsZW5hbWUpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNvbGxlY3Rpb24uZmluZE9uZUFuZERlbGV0ZSh7IGZpbGVuYW1lOiBuZXdGaWxlbmFtZSB9KTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZnMudW5saW5rU3luYyh0aGlzLmdldFN0b3JhZ2VEaXIoKSArIG5ld0ZpbGVuYW1lKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbXBvc3NpYmxlIGRlIFN1cHByaW1lcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgdGhyb3cgbmV3IEVycm9yKCdEZXNzaW4gQWJzZW50Jyk7XG4gICAgfVxuXG4gICAgY2hlY2tOYW1lKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gUkVHRVhfVElUTEUudGVzdChuYW1lKTtcbiAgICB9XG5cbiAgICBjaGVja1RhZ3ModGFnczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgbGV0IHZhbGlkVGFnTGlzdCA9IHRydWU7XG4gICAgICAgIGxldCB0YWdDdHIgPSAwO1xuICAgICAgICB0YWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKCFSRUdFWF9UQUcudGVzdCh0YWcpKSB7XG4gICAgICAgICAgICAgICAgdmFsaWRUYWdMaXN0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YWdDdHIrKztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB2YWxpZFRhZ0xpc3QgJiYgdGFnQ3RyIDw9IE1BWF9UQUdTO1xuICAgIH1cblxuICAgIGNoZWNrTWV0YURhdGEobWV0YURhdGE6IE1ldGFEYXRhKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5zVmFsaWRUaXRsZSA9IHRoaXMuY2hlY2tOYW1lKG1ldGFEYXRhLm5hbWUpO1xuICAgICAgICBjb25zdCBjb250YWluc0NvcnJlY3RUYWdzID0gdGhpcy5jaGVja1RhZ3MobWV0YURhdGEudGFncyk7XG4gICAgICAgIHJldHVybiBjb250YWluc1ZhbGlkVGl0bGUgJiYgY29udGFpbnNDb3JyZWN0VGFncztcbiAgICB9XG59XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6L1VzZXJzL1VTRVIvRG9jdW1lbnRzL0dpdEh1Yi9sb2cyOTkwLTEwOC9zZXJ2ZXIvYXBwL3NlcnZpY2VzL2RhdGFiYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs4MEZBQUEsS0FBQSxDQUFBLFdBQUEsMEJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQSxDQUVBLEtBQUEsQ0FBQSxFQUFBLDBCQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxXQUFBLDBCQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxTQUFBLDBCQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxDQUNBLEtBQUEsQ0FBQSxNQUFBLDBCQUFBLE9BQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDLHdCQUNBLE9BQUEsQ0FBQSxrQkFBQSxDQUFBLEMsd0JBSUEsR0FBYSxDQUFBLGVBQWUsQ0FBNUIsS0FBYSxDQUFBLGVBQWUsQ0FBNUIsV0FBQSxFQUFBLGdEQU1ZLEtBQUEsT0FBQSxDQUE4QixDQUNsQyxlQUFlLENBQUUsSUFEaUIsQ0FFbEMsa0JBQWtCLENBQUUsSUFGYyxDQUE5QixDQTJGWCxDQXRGRyxLQUFLLENBQUMsR0FBQSw2QkFBYyxXQUFBLENBQUEsWUFBZCxDQUFELENBQTJCLGdEQUM1QixDQUFDLEVBQUUsQ0FBQyxVQUFILENBQWMsS0FBSyxhQUFMLEVBQWQsQ0FBRCw2QkFBdUMsRUFBRSxDQUFDLFNBQUgsQ0FBYSxLQUFLLGFBQUwsRUFBYixDQUF2Qyw4QkFBNkUsS0FBSyxhQUFMLENBQXFCLEVBQUUsQ0FBQyxXQUFILENBQWUsS0FBSyxhQUFMLEVBQWYsQ0FBbEcsRUFENEIsd0JBRTVCLFNBQUEsQ0FBQSxXQUFBLENBQVksT0FBWixDQUFvQixHQUFwQixDQUF5QixLQUFLLE9BQTlCLEVBQ0ssSUFETCxDQUNXLE1BQUQsRUFBd0IsaURBQzFCLEtBQUssTUFBTCxDQUFjLE1BQWQsQ0FE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QUFjLEdBQUQsRUFBUSxpREFDakIsR0FBSSxDQUFDLFdBQUEsQ0FBQSxTQUFBLENBQVUsSUFBVixDQUFlLEdBQWYsQ0FBTCxDQUEwQixvREFDdEIsWUFBWSxDQUFHLEtBQWYsQ0FDSCxDQUZELGlDQURpQix3QkFJakIsTUFBTSxHQUNULENBTEQsRUFIb0Isd0JBU3BCLE1BQU8sNEJBQUEsWUFBWSwrQkFBSSxNQUFNLEVBQUksV0FBQSxDQUFBLFFBQWQsQ0FBbkIsQ0FDSCxDQUVELGFBQWEsQ0FBQyxRQUFELENBQW1CLHlCQUM1QixLQUFNLENBQUEsa0JBQWtCLDBCQUFHLEtBQUssU0FBTCxDQUFlLFFBQVEsQ0FBQyxJQUF4QixDQUFILENBQXhCLENBQ0EsS0FBTSxDQUFBLG1CQUFtQiwwQkFBRyxLQUFLLFNBQUwsQ0FBZSxRQUFRLENBQUMsSUFBeEIsQ0FBSCxDQUF6QixDQUY0Qix3QkFHNUIsTUFBTyw0QkFBQSxrQkFBa0IsK0JBQUksbUJBQUosQ0FBekIsQ0FDSCxDQWhHdUIsQ0FBNUIsQyx3QkFBYSxlQUFlLENBQUEsVUFBQSxDQUFBLENBRDNCLFdBQUEsQ0FBQSxVQUFBLEVBQzJCLENBQUEsQ0FBZixlQUFlLENBQWYsQyx3QkFBQSxPQUFBLENBQUEsZUFBQSxDQUFBLGVBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERBVEFCQVNFX0NPTExFQ1RJT04sIERBVEFCQVNFX05BTUUsIERBVEFCQVNFX1VSTCwgTUFYX1RBR1MsIFJFR0VYX1RBRywgUkVHRVhfVElUTEUsIFNUT1JBR0VfRElSLCBTVE9SQUdFX1BBVEggfSBmcm9tICdAYXBwL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBNZXRhRGF0YSB9IGZyb20gJ0Bjb21tb24vY29tbXVuaWNhdGlvbi9tZXRhZGF0YSc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgeyBpbmplY3RhYmxlIH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IENvbGxlY3Rpb24sIE1vbmdvQ2xpZW50LCBNb25nb0NsaWVudE9wdGlvbnMgfSBmcm9tICdtb25nb2RiJztcbmltcG9ydCAqIGFzIG11bHRlciBmcm9tICdtdWx0ZXInO1xuaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcblxuXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGF0YWJhc2VTZXJ2aWNlIHtcbiAgICBjbGllbnQ6IE1vbmdvQ2xpZW50O1xuICAgIGNvbGxlY3Rpb246IENvbGxlY3Rpb248TWV0YURhdGE+O1xuICAgIG11bHRlck9iamVjdDogbXVsdGVyLk11bHRlcjtcbiAgICBsb2NhbERyYXdpbmdzOiBzdHJpbmdbXTtcblxuICAgIHByaXZhdGUgb3B0aW9uczogTW9uZ29DbGllbnRPcHRpb25zID0ge1xuICAgICAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXG4gICAgICAgIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgc3RhcnQodXJsOiBzdHJpbmcgPSBEQVRBQkFTRV9VUkwpIHtcbiAgICAgICAgIWZzLmV4aXN0c1N5bmModGhpcy5nZXRTdG9yYWdlRGlyKCkpID8gZnMubWtkaXJTeW5jKHRoaXMuZ2V0U3RvcmFnZURpcigpKSA6ICh0aGlzLmxvY2FsRHJhd2luZ3MgPSBmcy5yZWFkZGlyU3luYyh0aGlzLmdldFN0b3JhZ2VEaXIoKSkpO1xuICAgICAgICBNb25nb0NsaWVudC5jb25uZWN0KHVybCwgdGhpcy5vcHRpb25zKVxuICAgICAgICAgICAgLnRoZW4oKGNsaWVudDogTW9uZ29DbGllbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjbGllbnQuZGIoREFUQUJBU0VfTkFNRSkuY29sbGVjdGlvbihEQVRBQkFTRV9DT0xMRUNUSU9OKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yOiBFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKChlcnJvci5tZXNzYWdlID0gJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3InKSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRTdG9yYWdlUm9vdFBhdGgoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIFNUT1JBR0VfUEFUSDtcbiAgICB9XG5cbiAgICBnZXRTdG9yYWdlRGlyKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBTVE9SQUdFX0RJUjtcbiAgICB9XG5cbiAgICBjcmVhdGVNdWx0ZXJVcGxvYWQoZGlyZWN0b3J5OiBzdHJpbmcpOiBtdWx0ZXIuTXVsdGVyIHtcbiAgICAgICAgdGhpcy5tdWx0ZXJPYmplY3QgPSBtdWx0ZXIoeyBkZXN0OiBkaXJlY3RvcnkgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLm11bHRlck9iamVjdDtcbiAgICB9XG5cbiAgICBhc3luYyBwb3N0RHJhd2luZyhtZXRhRGF0YTogTWV0YURhdGEpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tNZXRhRGF0YShtZXRhRGF0YSkpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY29sbGVjdGlvbi5pbnNlcnRPbmUobWV0YURhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKHRoaXMuZ2V0U3RvcmFnZURpcigpICsgbWV0YURhdGEuZmlsZW5hbWUpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ03DqXRhZG9ubsOpZXMgbm9uIHZhbGlkZXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldE1ldGFEYXRhKCk6IFByb21pc2U8TWV0YURhdGFbXT4ge1xuICAgICAgICB0aGlzLmxvY2FsRHJhd2luZ3MgPSBmcy5yZWFkZGlyU3luYyh0aGlzLmdldFN0b3JhZ2VEaXIoKSk7XG4gICAgICAgIGNvbnN0IG1ldGFkYXRhczogTWV0YURhdGFbXSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uXG4gICAgICAgICAgICAuZmluZCh7fSlcbiAgICAgICAgICAgIC50b0FycmF5KClcbiAgICAgICAgICAgIC50aGVuKChtZXRhRGF0YXM6IE1ldGFEYXRhW10pID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1ldGEgb2YgbWV0YURhdGFzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvY2FsRHJhd2luZ3MuaW5jbHVkZXMobWV0YS5maWxlbmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhcy5wdXNoKG1ldGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBtZXRhZGF0YXM7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGVEcmF3aW5nKG5ld0ZpbGVuYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5sb2NhbERyYXdpbmdzID0gZnMucmVhZGRpclN5bmModGhpcy5nZXRTdG9yYWdlRGlyKCkpO1xuICAgICAgICBpZiAodGhpcy5sb2NhbERyYXdpbmdzLmluY2x1ZGVzKG5ld0ZpbGVuYW1lKSkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmZpbmRPbmVBbmREZWxldGUoeyBmaWxlbmFtZTogbmV3RmlsZW5hbWUgfSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGZzLnVubGlua1N5bmModGhpcy5nZXRTdG9yYWdlRGlyKCkgKyBuZXdGaWxlbmFtZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW1wb3NzaWJsZSBkZSBTdXBwcmltZXInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHRocm93IG5ldyBFcnJvcignRGVzc2luIEFic2VudCcpO1xuICAgIH1cblxuICAgIGNoZWNrTmFtZShuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIFJFR0VYX1RJVExFLnRlc3QobmFtZSk7XG4gICAgfVxuXG4gICAgY2hlY2tUYWdzKHRhZ3M6IHN0cmluZ1tdKTogYm9vbGVhbiB7XG4gICAgICAgIGxldCB2YWxpZFRhZ0xpc3QgPSB0cnVlO1xuICAgICAgICBsZXQgdGFnQ3RyID0gMDtcbiAgICAgICAgdGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICghUkVHRVhfVEFHLnRlc3QodGFnKSkge1xuICAgICAgICAgICAgICAgIHZhbGlkVGFnTGlzdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFnQ3RyKys7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdmFsaWRUYWdMaXN0ICYmIHRhZ0N0ciA8PSBNQVhfVEFHUztcbiAgICB9XG5cbiAgICBjaGVja01ldGFEYXRhKG1ldGFEYXRhOiBNZXRhRGF0YSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBjb250YWluc1ZhbGlkVGl0bGUgPSB0aGlzLmNoZWNrTmFtZShtZXRhRGF0YS5uYW1lKTtcbiAgICAgICAgY29uc3QgY29udGFpbnNDb3JyZWN0VGFncyA9IHRoaXMuY2hlY2tUYWdzKG1ldGFEYXRhLnRhZ3MpO1xuICAgICAgICByZXR1cm4gY29udGFpbnNWYWxpZFRpdGxlICYmIGNvbnRhaW5zQ29ycmVjdFRhZ3M7XG4gICAgfVxufVxuIl19